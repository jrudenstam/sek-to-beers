<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Kronor to beers!</title>
	<style>

	</style>
</head>
<body>
	<ul id="beers-list"></ul>
	<form action="" method="get">
		<input type="number" name="amount" id="amount" value="" placeholder="Belopp i SEK" />
		<label for="prefered">RÃ¤kna i:</label>
		<input type="text" name="prefered" value="" placeholder="Artikelnummer">
	</form>
	<h1 id="result"></h1>
	<script type="text/javascript">
		(function(){
			var h = {
				ajaxObject: (function(){
					var factories = [
						function () {return new XMLHttpRequest()},
						function () {return new ActiveXObject("Msxml2.XMLHTTP")},
						function () {return new ActiveXObject("Msxml3.XMLHTTP")},
						function () {return new ActiveXObject("Microsoft.XMLHTTP")}
					],
					xmlhttp = false;

					for (var i=0;i<factories.length;i++) {
						try {
							xmlhttp = factories[i]();
						}
						catch (e) {
							continue;
						}
						// Return function that creates new object
						// not an instance
						xmlhttp = factories[i];
						break;
					}

					return xmlhttp;
				})(),
				ajax: function( url, callback, data, async, ctx, args ) {
					var method = data ? 'POST' : 'GET', // Default to 'GET'
					async = async || true, // Default to async mode
					req = this.ajaxObject(),
					ctx = ctx || window;

					if (!req) {
						return;
					}

					req.open(method,url,async);

					// Set extra headers passed to ajax()
					if (arguments.length > 4) {
						for (var i = 4; i < arguments.length; i++){
							if (arguments[i][0] && arguments[i][0]){
								req.setRequestHeader(arguments[i][0], arguments[i][1]);
							}
						}
					}

					if (data) {
						req.setRequestHeader('Content-type','application/x-www-form-urlencoded');
					}

					req.onreadystatechange = function () {
						if (req.readyState != 4) {
							return;
						}

						if (req.status != 200 && req.status != 304) {
							return;
						}

						/*
						 * Pass on any extra arguments the callback
						 */
						callback.apply(ctx, [req, args]);
					}

					if (req.readyState == 4) {
						return;
					}

					//req.send(data);
				},

				registerEventHandler: (function(){
					if ( document.addEventListener ) {
						return function( node, type, callback ){
							node.addEventListener(type, callback, false );
						};
					} else if ( document.attachEvent ){
						return function( node, type, callback ) {
							node.attachEvent( 'on' + type, callback );
						};
					}
				})(),

				unregisterEventHandler: (function(){
					if ( document.addEventListener ) {
						return function( node, type, callback ){
							node.removeEventListener(type, callback, false );
						};
					} else if ( document.attachEvent ){
						return function( node, type, callback ) {
							node.detachEvent( 'on' + type, callback );
						};
					}
				})(),

				addEvent: function( node, type, callback, sender ) {
					var wrapCallback = (function( helper ){
						return function( event ){
							callback.apply(this, [helper.normaliseEvent(event || window.event), sender]);
						}
					})(this);

					this.registerEventHandler(node, type, wrapCallback);

					// Return object to make event handler easy to detach
					return {
						node: node,
						type: type,
						callback: wrapCallback
					};
				},

				removeEvent: function( object ) {
					this.unregisterEventHandler( object.node, object.type, object.callback );
				},

				normaliseEvent: function( event ) {
					if (!event.stopPropagation) {
						event.stopPropagation = function() {this.cancelBubble = true;};
						event.preventDefault = function() {this.returnValue = false;};
					}

					if (!event.stop) {
						event.stop = function() {
							this.stopPropagation();
							this.preventDefault();
						};
					}

					if (event.srcElement && !event.target) {
						event.target = event.srcElement;
					}

					return event;
				},
			};

			var app = {
				settings: {
					apiUrl: 'sortiment.xml',
					list: document.getElementById('beers-list'),
					result: document.getElementById('result'),
					input: document.getElementById('amount')
				},

				init: function() {
					this.bindUiActions();
				},

				bindUiActions: function() {
					h.addEvent(this.settings.input, 'change', this.get, this);
				},

				get: function( event, self ) {
					debugger;
					h.ajax( self.settings.apiUrl, function( req ) {
						console.log(req.data);
					}, false, true, self );
				},

				convert: function( sek ) {
					
				}
			};

			app.init();
		})();
	</script>
</body>
</html>